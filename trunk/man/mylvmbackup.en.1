.\" Copyright (c) 1992, 2001 Free Software Foundation
.\" See section COPYING for conditions for redistribution
.TH mylvmbackup 1 "08 Aug 2003" "MYSQL AB" "MYSQL"
.de BP
.sp
.ti -.2i
\(**
..
.SH NAME
\fBmylvmbackup\fP \- utility for creating MySQL backups via LVM snapshots
.SH SYNOPSIS
.hy 0
.na
\fBmylvmbackup\fP
[\fB\-\-user=\fP\fIstring\fP]
[\fB\-\-password=\fP\fIstring\fP]
[\fB\-\-host=\fP\fIstring\fP]
[\fB\-\-port=\fP\fIstring\fP]
[\fB\-\-socket=\fP\fIstring\fP]
[\fB\-\-lvcreate=\fP\fIstring\fP]
[\fB\-\-lvremove=\fP\fIstring\fP]
[\fB\-\-vgname=\fP\fIstring\fP]
[\fB\-\-lvname=\fP\fIstring\fP]
[\fB\-\-relpath=\fP\fIstring\fP]
[\fB\-\-lvsize=\fP\fIstring\fP]
[\fB\-\-prefix=\fP\fIstring\fP]
[\fB\-\-datefmt=\fP\fIstring\fP]
[\fB\-\-mountdir=\fP\fIstring\fP]
[\fB\-\-backupdir=\fP\fIstring\fP]
[\fB\-\-mount=\fP\fIstring\fP]
[\fB\-\-umount=\fP\fIstring\fP]
[\fB\-\-tar=\fP\fIstring\fP]
[\fB\-\-xfs\fP]
[\fB\-\-help\fP]
.ad b
.hy 1
.SH DESCRIPTION
\fBmylvmbackup\fP is a script for quickly creating backups of MySQL server's
data files.  To perform a backup, \fBmylvmbackup\fP obtains a read lock on all
tables and flushes all server caches to disk, makes an LVM snapshot of the
volume containing the MySQL data directory, and unlocks the tables again.  The
snapshot process takes only a small amount of time. When it is done, the server
can continue normal operations, while the actual file backup proceeds.
.PP
The LVM snapshot is mounted to a temporary directory and all data is backed up
using the \fItar\fP program.  The archive file is created using a name of the
form \fIbackup-YYYYMMDD_hhmmss_mysql.tar.gz\fP, where \fIYYYY\fP, \fIMM\fP,
\fIDD\fP, \fIhh\fP, \fImm\fP, and \fIss\fP represent the year, month, day,
hour, minute, and second of the time at which the backup occurred. The prefix
\fIbackup\fP and the date format can be modified. The use of timestamped
archive names allows you to run \fBmylvmbackup\fP many times without danger of
rewriting old archives.
.PP
It is necessary to run \fBmylvmbackup\fP on the same host where the MySQL
server runs.  If your MySQL daemon is not listening on \fBlocalhost\fP, or
using the default socket location, you must specify \fI--host\fP or
\fI--socket\fP.  Even though \fBmylvmbackup\fP communicates with the server
through a normal client connection to obtain the read lock and flush data, it
makes the backup by accessing the file system directly.  It is also necessary
that the MySQL server data directory resides on an LVM volume.  (It is,
however, a good idea to do the LVM backup to a different partition than the one
where the data directory resides.  Otherwise, there is a good chance that LVM
will run out of undo space for LVM snapshot maintenance and the backup will
fail.)
.PP
The user who invokes \fBmylvmbackup\fP must have sufficient filesystem
permissions to create the LVM snapshot and mount it.  This includes read/write
access to the backup directory.
.PP
\fBmylvmbackup\fP is a Perl script that uses DBI to access the MySQL server.
For proper operation, it requires that Perl be installed, as well as the DBI
and DBD::mysql modules.  In addition, \fBmylvmbackup\fP uses several other
programs: \fIdate\fP to constuct the archive filename, \fItar\fP to back up
data, LVM utilities to create and remove the LVM snapshot, and the system
utilities \fImount\fP and \fIumount\fP.
.SH OPTIONS
\fBmylvmbackup\fP supports the following options on the command line:
.TP
.BI \-\-user= string
Specifies the username to use for connecting to the MySQL server.
The default is \fIroot\fP.
.TP
.BI \-\-password= string
Specifies the password to use for connecting to the MySQL server.
The default is the empty string (no password).
.TP
.BI \-\-host= string
Specifies the host name to use for connecting to the MySQL server.
The default is the empty string.
.TP
.BI \-\-port= number
Specifies the TCP port number to use for connecting to the MySQL server.
The default is \fI3306\fI.
.TP
.BI \-\-socket= string
Specifies the path to the local socket file, if it is not located at the default
location.
The default is the empty string.
.TP
.BI \-\-lvcreate= string
Specifies the pathname for the \fIlvcreate\fP program.
The default is \fI/sbin/lvcreate\fP.
.TP
.BI \-\-lvremove= string
Specifies the pathname for the \fIlvremove\fP program.
The default is \fI/sbin/lvremove\fP.
.TP
.BI \-\-vgname= string
Specifies the volume group of the logical volume where the MySQL data directory
is located.
The default is \fImysql\fP.
.TP
.BI \-\-lvname= string
Specifies the name of the logical volume where the MySQL data directory
is located.
The default is \fIdata\fP.
.TP
.BI \-\-relpath= string
Relative path on the logical volume to the MySQL data directory
The default is the empty string.
.TP
.BI \-\-lvsize= string
Specifies the size for the snapshot volume.
The default is \fI5G\fP (5 gigabytes).
.TP
.BI \-\-prefix= string
Prefix added to the backup file names. It is also appended to the name of the
directory used to mount the snapshot volume.
The default value is \fIbackup\fP.
.TP
.BI \-\-datefmt= string
Format of the time stamp included in the backup file name. See the
\fIdate(1)\fP man page for a description of the format.
The default value is \fI%Y%m%d_%H%M%S\fP.
.TP
.BI \-\-mountdir= string
Path for mounting the snapshot volume to.
The default value is \fI/var/tmp/mylvmbackup/mnt/\fP.
.TP
.BI \-\-backupdir= string
Specifies the pathname of the directory where the archive files will be
written to.
The default is \fI/var/tmp/mylvmbackup/backup/\fP.
The backup directory must not be on the same volume as the
MySQL data directory.
.TP
.BI \-\-mount= string
Specifies the pathname for the \fImount\fP program.
The default is \fI/bin/mount\fP.
.TP
.BI \-\-umount= string
Specifies the pathname for the \fIumount\fP program.
The default is \fI/bin/umount\fP.
.TP
.BI \-\-tar= string
Specifies the pathname for the \fItar\fP program.
The default is \fI/bin/tar\fP.
.TP
.B \-\-xfs
Use the \fInouuid\fP mount option to safely mount XFS snapshot partitions.
.TP
.B \-\-help
Displays a help message showing the available options.
.SH FILES
.TP 15
\fI/usr/local/bin/mylvmbackup\fP
The \fBmylvmbackup\fP script.
.SH "SEE ALSO"
\fIdate(\fP1),
\fImount(\fP8),
\fItar(\fP1),
\fIlvcreate\fP(8),
\fIlvremove(\fP8),
\fIumount(\fP8)
.SH CREDITS
\fBmylvmbackup\fP is distributed under the GNU public license. See the file COPYING for details.
.PP
This program was initially written by Aleksey "Walrus" Kishkin from MySQL AB, with suggestions
from Peter Zaitsev and Lenz Grimmer.
.PP
Robin H. Johnson from the Gentoo project cleaned up the code and added several
useful features. See the \fBChangeLog\fB for more details.
